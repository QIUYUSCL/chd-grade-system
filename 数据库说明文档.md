# 主题：长安大学成绩管理系统数据库设计说明，包括数据库基本信息、表结构总览、详细表结构说明、数据关系模型、核心设计规则及测试数据说明

# 长安大学成绩管理系统数据库设计说明文档

## 文档信息

|项目|内容|
|---|---|
|文档版本|V1.0|
|适用系统|长安大学成绩管理系统|
|数据库版本|MySQL 8.0+|
|设计日期|2025年11月|
|维护人|-|
## 1. 概述

### 1.1 文档目的

本文档详细说明长安大学成绩管理系统数据库的设计规范、表结构、字段含义、关联关系及安全设计，为系统开发、维护、运维提供统一的数据库参考依据。

### 1.2 系统背景

本数据库用于管理长安大学学生成绩相关数据，涵盖学生、教师、课程、成绩记录及安全审计等核心模块，满足成绩录入、存储、校验、审计的全流程需求，保障数据完整性、安全性和可追溯性。

### 1.3 设计原则

1. **数据完整性**：通过外键约束、非空约束确保关联数据一致性；

2. **安全性**：采用哈希防篡改、审计日志、数据加密存储等机制；

3. **性能优化**：针对高频查询字段建立索引，降低查询耗时；

4. **兼容性**：基于MySQL 8.0+设计，兼容主流云数据库/本地部署环境；

5. **可维护性**：表结构命名规范、注释完整，便于后期扩展和维护。

## 2. 环境要求

|类别|要求|
|---|---|
|数据库类型|MySQL（8.0及以上版本）|
|存储引擎|InnoDB（支持外键、事务、行级锁）|
|字符集|utf8mb4（兼容全量中文/特殊字符）|
|排序规则|utf8mb4_unicode_ci（统一字符排序规则）|
|运行环境|Linux/Windows Server 2019+|
## 3. 数据库整体结构

### 3.1 数据库基本信息

- 数据库名：`chd_grade_db`

- 核心表数量：5张（学生表、教师表、课程表、成绩记录表、安全审计日志表）

- 表间关系：成绩记录表为核心关联表，关联学生、教师、课程表；审计日志表独立记录所有数据操作行为。

### 3.2 表结构总览

|表名|中文名称|核心功能|
|---|---|---|
|`students`|学生信息表|存储学生基础信息，作为成绩记录的关联父表|
|`teachers`|教师信息表|存储教师基础信息，关联课程和成绩录入操作|
|`courses`|课程信息表|存储课程基础信息，关联任课教师|
|`grade_records`|成绩记录表|存储学生成绩（加密）、考试类型、状态等核心数据|
|`security_log`|安全审计日志表|记录所有数据操作行为，支持溯源和防篡改校验|
## 4. 详细表结构说明

### 4.1 学生信息表（`students`）

|字段名|数据类型|约束条件|注释|补充说明|
|---|---|---|---|---|
|`student_id`|VARCHAR(20)|PRIMARY KEY|学号|唯一标识学生，字符集utf8mb4|
|`name`|VARCHAR(50)|NOT NULL|姓名|-|
|`password_hash`|VARCHAR(100)|NOT NULL|密码哈希(BCrypt)|存储加密后的密码，不存明文|
|`class_name`|VARCHAR(50)|NULL|班级|如“软件2101”|
|`major`|VARCHAR(50)|NULL|专业|如“软件工程”|
|`email`|VARCHAR(100)|NULL|邮箱|学校统一邮箱|
|`created_at`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|自动记录数据插入时间|
|索引|`idx_class (class_name)`|-|班级索引|优化按班级查询学生的性能|
### 4.2 教师信息表（`teachers`）

|字段名|数据类型|约束条件|注释|补充说明|
|---|---|---|---|---|
|`teacher_id`|VARCHAR(20)|PRIMARY KEY|教师编号|唯一标识教师，字符集utf8mb4|
|`name`|VARCHAR(50)|NOT NULL|姓名|-|
|`password_hash`|VARCHAR(100)|NOT NULL|密码哈希(BCrypt)|存储加密后的密码，不存明文|
|`department`|VARCHAR(50)|NULL|院系|如“信息工程学院”|
|`title`|VARCHAR(20)|NULL|职称|如“教授”“讲师”|
|`email`|VARCHAR(100)|NULL|邮箱|学校统一邮箱|
|`created_at`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|自动记录数据插入时间|
|索引|`idx_department (department)`|-|院系索引|优化按院系查询教师的性能|
### 4.3 课程信息表（`courses`）

|字段名|数据类型|约束条件|注释|补充说明|
|---|---|---|---|---|
|`course_id`|VARCHAR(20)|PRIMARY KEY|课程编号|唯一标识课程，字符集utf8mb4|
|`course_name`|VARCHAR(100)|NOT NULL|课程名称|如“数据结构”|
|`credit`|DECIMAL(3,1)|NULL|学分|保留1位小数，如4.0、2.5|
|`department`|VARCHAR(50)|NULL|开课院系|课程所属院系|
|`teacher_id`|VARCHAR(20)|NULL|任课教师|关联教师表的`teacher_id`|
|`semester`|VARCHAR(20)|NULL|学期|格式“年-年-学期”，如“2024-2025-1”|
|`created_at`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|自动记录数据插入时间|
|外键|`fk_course_teacher (teacher_id)`|REFERENCES teachers(teacher_id) ON DELETE SET NULL|关联教师表|教师删除时，课程的任课教师设为NULL|
|索引|`idx_teacher (teacher_id)`|-|教师索引|优化按教师查询课程的性能|
### 4.4 成绩记录表（`grade_records`）

|字段名|数据类型|约束条件|注释|补充说明|
|---|---|---|---|---|
|`record_id`|BIGINT|AUTO_INCREMENT、PRIMARY KEY|成绩记录ID|自增主键，唯一标识每条成绩记录|
|`student_id`|VARCHAR(20)|NOT NULL|学号|关联学生表，字符集utf8mb4|
|`course_id`|VARCHAR(20)|NOT NULL|课程编号|关联课程表，字符集utf8mb4|
|`daily_score_encrypted`|VARCHAR(200)|NULL|平时成绩(加密)|AES加密存储，非明文|
|`final_score_encrypted`|VARCHAR(200)|NULL|期末成绩(加密)|AES加密存储，非明文|
|`makeup_score_encrypted`|VARCHAR(200)|NULL|补考成绩(加密)|仅补考记录有值，AES加密|
|`total_score_encrypted`|VARCHAR(200)|NULL|总成绩(加密)|AES加密存储，非明文|
|`exam_type`|ENUM('正考','补考')|DEFAULT '正考'|考试类型|仅支持正考/补考两类|
|`status`|ENUM('DRAFT','SUBMITTED')|DEFAULT 'DRAFT'|状态|DRAFT=草稿（未提交），SUBMITTED=已提交|
|`teacher_id`|VARCHAR(20)|NOT NULL|录入教师|关联教师表，字符集utf8mb4|
|`semester`|VARCHAR(20)|NOT NULL|学期|格式“年-年-学期”|
|`created_at`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|创建时间|自动记录数据插入时间|
|`updated_at`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP|更新时间|自动记录数据修改时间|
|`data_hash`|VARCHAR(64)|VIRTUAL生成列|数据完整性哈希|基于student_id+course_id+exam_type+total_score_encrypted生成SHA256哈希，防篡改|
|外键1|`fk_grade_student (student_id)`|REFERENCES students(student_id) ON DELETE CASCADE|关联学生表|学生删除时，同步删除成绩记录|
|外键2|`fk_grade_course (course_id)`|REFERENCES courses(course_id) ON DELETE CASCADE|关联课程表|课程删除时，同步删除成绩记录|
|外键3|`fk_grade_teacher (teacher_id)`|REFERENCES teachers(teacher_id) ON DELETE CASCADE|关联教师表|教师删除时，同步删除成绩记录|
|索引1|`idx_student (student_id)`|-|学生索引|优化按学生查询成绩的性能|
|索引2|`idx_teacher (teacher_id)`|-|教师索引|优化按教师查询成绩的性能|
|索引3|`idx_semester (semester)`|-|学期索引|优化按学期查询成绩的性能|
|索引4|`idx_status (status)`|-|状态索引|优化按状态查询成绩的性能|
|索引5|`idx_exam_type (exam_type)`|-|考试类型索引|优化按考试类型查询成绩的性能|
### 4.5 安全审计日志表（`security_log`）

|字段名|数据类型|约束条件|注释|补充说明|
|---|---|---|---|---|
|`log_id`|BIGINT|AUTO_INCREMENT、PRIMARY KEY|日志ID|自增主键，唯一标识每条日志|
|`operation_type`|VARCHAR(20)|NOT NULL|操作类型|INSERT/UPDATE/DELETE|
|`table_name`|VARCHAR(50)|NOT NULL|操作表名|如“grade_records”“students”|
|`record_id`|VARCHAR(50)|NULL|记录ID|被操作记录的主键值|
|`operator_id`|VARCHAR(20)|NOT NULL|操作人ID|学生/教师/管理员的ID|
|`operator_type`|ENUM('STUDENT','TEACHER','ADMIN')|NULL|操作人类型|区分操作人身份|
|`data_hash`|VARCHAR(64)|NULL|数据哈希|操作后的数据哈希值，用于校验|
|`client_ip`|VARCHAR(45)|NULL|客户端IP|记录操作来源IP（支持IPv6）|
|`operation_time`|TIMESTAMP|DEFAULT CURRENT_TIMESTAMP|操作时间|自动记录操作发生时间|
|索引1|`idx_operator (operator_id)`|-|操作人索引|优化按操作人查询日志的性能|
|索引2|`idx_operation_time (operation_time)`|-|操作时间索引|优化按时间范围查询日志的性能|
|索引3|`idx_table_record (table_name, record_id)`|-|表+记录ID索引|优化按表+记录查询日志的性能|
## 5. 数据关系模型

### 5.1 核心关联关系

1. **学生-成绩**：一对多（1个学生对应多条成绩记录），通过`student_id`关联；

2. **教师-课程**：一对多（1个教师可讲授多门课程），通过`teacher_id`关联；

3. **教师-成绩**：一对多（1个教师可录入多条成绩记录），通过`teacher_id`关联；

4. **课程-成绩**：一对多（1门课程对应多条成绩记录），通过`course_id`关联；

5. **审计日志-业务表**：多对多（1条业务记录的操作对应多条日志，1条日志仅对应1条业务记录），通过`table_name+record_id`关联。

### 5.2 ER图（文字描述）

```Plain Text

```

## 6. 核心设计规则

### 6.1 外键约束规则

1. 级联删除：学生/教师/课程表的记录删除时，关联的成绩记录自动删除，避免脏数据；

2. 置空规则：课程表关联的教师删除时，课程的`teacher_id`设为NULL（课程保留，仅清空任课教师）；

3. 非空约束：成绩记录的核心关联字段（`student_id`/`course_id`/`teacher_id`）不允许为空，确保数据可追溯。

### 6.2 生成列（`data_hash`）规则

1. 计算逻辑：`SHA2(CONCAT(student_id, course_id, exam_type, IFNULL(total_score_encrypted,'')), 256)`；

2. 类型：虚拟列（VIRTUAL），查询时实时计算，不占用物理存储，避免与外键冲突；

3. 用途：校验成绩数据是否被篡改，若哈希值变化则说明数据被非法修改。

### 6.3 数据加密规则

1. 加密字段：所有成绩相关字段（平时/期末/补考/总成绩）均采用AES对称加密存储，仅系统解密后展示；

2. 密码存储：学生/教师密码采用BCrypt哈希算法加密，不可逆，防止密码泄露。

### 6.4 审计规则

1. 记录范围：所有对业务表（`students`/`teachers`/`courses`/`grade_records`）的INSERT/UPDATE/DELETE操作必须记录日志；

2. 日志内容：需包含操作人、操作类型、操作时间、客户端IP、数据哈希，确保操作可溯源、数据可校验。

## 7. 测试数据说明

### 7.1 测试数据内容

脚本中包含可选的测试数据，用于验证数据库功能，具体如下：

|表名|测试数据示例|
|---|---|
|`students`|学号：2021001234，姓名：张三，班级：软件2101，专业：软件工程；<br>学号：2021005678，姓名：李四，班级：软件2101，专业：软件工程|
|`teachers`|教师编号：T001，姓名：王教授，院系：信息工程学院，职称：教授|
|`courses`|课程编号：CS202，课程名称：数据结构，学分：4.0，任课教师：T001，学期：2024-2025-1|
|`grade_records`|学号：2021001234，课程编号：CS202，总成绩（加密）：AES_90，考试类型：正考，状态：已提交|
### 7.2 测试数据用途

1. 验证表结构和外键关联的正确性；

2. 验证生成列`data_hash`的计算逻辑；

3. 为系统功能测试提供基础数据。

## 8. 维护与运维建议

### 8.1 日常维护

1. **外键检查**：定期执行`SET FOREIGN_KEY_CHECKS = 1`验证外键完整性，避免数据不一致；

2. **索引优化**：根据实际查询频率调整索引，避免冗余索引；

3. **日志清理**：定期归档`security_log`表的历史日志（如超过1年的日志），提升查询性能。

### 8.2 安全运维

1. 禁止直接修改`grade_records`表的成绩数据，所有修改需通过系统接口并记录审计日志；

2. 定期校验`data_hash`值，确保成绩数据未被篡改；

3. 严格控制数据库账号权限，仅管理员可访问`security_log`表。

### 8.3 扩展建议

1. 若需支持多校区/多学年管理，可在`courses`/`grade_records`表添加`campus`（校区）字段；

2. 若需支持成绩等级制（如优/良/中），可扩展`exam_type`枚举值或新增`score_level`字段；

3. 若数据量较大，可对`grade_records`表按`semester`分表，提升查询性能。

## 9. 附录

### 9.1 常用查询示例

1. 查询某学生的所有成绩：

```SQL

```

1. 查询某教师录入的已提交成绩：

```SQL

```

1. 校验成绩数据哈希（防篡改）：

```SQL

```

### 9.2 错误码说明

|错误码|原因|解决方案|
|---|---|---|
|1215|外键约束不满足|确保关联字段数据类型/字符集一致，父表先创建|
|3192|存储型生成列依赖外键列|将生成列改为VIRTUAL，或先加外键再加生成列|
> （注：文档部分内容可能由 AI 生成）